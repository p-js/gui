!function(a,b){"object"==typeof PJS&&PJS.require(["_","$","handlebars","backbone","pjs-logger"],function(){PJS.provide("pjs-gui",b.apply(null,arguments))})}(this,function(a,b,c,d,e){var f=function(){return this.Templates=this.Templates||{},this.Templates["src/ad-view/template.html"]=c.template({1:function(a,b,c,d){var e,f="function",g=b.helperMissing,h=this.escapeExpression;return'<a class="pjs-ad-gui-learn-more" href="'+h((e=null!=(e=b.buttonLink||(null!=a?a.buttonLink:a))?e:g,typeof e===f?e.call(a,{name:"buttonLink",hash:{},data:d}):e))+'" target="'+h((e=null!=(e=b.buttonTarget||(null!=a?a.buttonTarget:a))?e:g,typeof e===f?e.call(a,{name:"buttonTarget",hash:{},data:d}):e))+'">\n	'+h((e=null!=(e=b.buttonText||(null!=a?a.buttonText:a))?e:g,typeof e===f?e.call(a,{name:"buttonText",hash:{},data:d}):e))+"\n</a>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f='<span class="pjs-ad-gui-countdown"></span>\n';return e=b["if"].call(a,null!=a?a.buttonLink:a,{name:"if",hash:{},fn:this.program(1,d),inverse:this.noop,data:d}),null!=e&&(f+=e),f},useData:!0}),this.Templates["src/bottom/template.html"]=c.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f="function",g=b.helperMissing,h=this.escapeExpression;return'<div class="pjs-gui-current-time">00:00</div>\n<div class="'+h((e=null!=(e=b.slider||(null!=a?a.slider:a))?e:g,typeof e===f?e.call(a,{name:"slider",hash:{},data:d}):e))+'">\n	<div class="'+h((e=null!=(e=b.slider||(null!=a?a.slider:a))?e:g,typeof e===f?e.call(a,{name:"slider",hash:{},data:d}):e))+'-background"></div>\n	<div class="'+h((e=null!=(e=b.slider||(null!=a?a.slider:a))?e:g,typeof e===f?e.call(a,{name:"slider",hash:{},data:d}):e))+'-progress-container">\n		<div class="'+h((e=null!=(e=b.slider||(null!=a?a.slider:a))?e:g,typeof e===f?e.call(a,{name:"slider",hash:{},data:d}):e))+'-buffered"></div>\n		<div class="'+h((e=null!=(e=b.slider||(null!=a?a.slider:a))?e:g,typeof e===f?e.call(a,{name:"slider",hash:{},data:d}):e))+'-progress"></div>\n	</div>\n	<div class="'+h((e=null!=(e=b.slider||(null!=a?a.slider:a))?e:g,typeof e===f?e.call(a,{name:"slider",hash:{},data:d}):e))+'-segment-container"></div>\n	<div class="'+h((e=null!=(e=b.slider||(null!=a?a.slider:a))?e:g,typeof e===f?e.call(a,{name:"slider",hash:{},data:d}):e))+'-thumb-container">\n		<div class="'+h((e=null!=(e=b.slider||(null!=a?a.slider:a))?e:g,typeof e===f?e.call(a,{name:"slider",hash:{},data:d}):e))+'-thumb"/>\n	</div>\n</div>\n<div class="pjs-gui-duration">00:00</div>\n'},useData:!0}),this.Templates["src/share/template.html"]=c.template({1:function(a){var b=this.lambda,c=this.escapeExpression;return'<div class="pjs-gui-share-item pjs-share-'+c(b(a,a))+'" data-share-id="'+c(b(a,a))+'"></div>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f,g,h="function",i=b.helperMissing,j=b.blockHelperMissing,k="";return f=null!=(f=b.share||(null!=a?a.share:a))?f:i,g={name:"share",hash:{},fn:this.program(1,d),inverse:this.noop,data:d},e=typeof f===h?f.call(a,g):f,b.share||(e=j.call(a,e,g)),null!=e&&(k+=e),k},useData:!0}),this.Templates["src/center-controls/template.html"]=c.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="pjs-gui-center-controls">\n	<div class="pjs-gui-controls-rewind pjs-gui-controls-button"></div>\n	<div class="pjs-gui-controls-play-pause pjs-gui-controls-button"></div>\n</div>\n'},useData:!0}),this.Templates["src/top/template.html"]=c.template({1:function(){return'	<div class="pjs-gui-controls-cc"></div>\n'},3:function(){return'	<div class="pjs-gui-controls-fullscreen"></div>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f,g="function",h=b.helperMissing,i='<div class="pjs-gui-flexbox pjs-gui-top-container">\n	<div class="pjs-gui-top-metadata">';return f=null!=(f=b.metadata||(null!=a?a.metadata:a))?f:h,e=typeof f===g?f.call(a,{name:"metadata",hash:{},data:d}):f,null!=e&&(i+=e),i+='</div>\n	<div class="pjs-gui-controls-share"></div>\n',e=b["if"].call(a,null!=a?a.ccEnabled:a,{name:"if",hash:{},fn:this.program(1,d),inverse:this.noop,data:d}),null!=e&&(i+=e),e=b["if"].call(a,null!=a?a.fullscreenEnabled:a,{name:"if",hash:{},fn:this.program(3,d),inverse:this.noop,data:d}),null!=e&&(i+=e),i+"</div>\n"},useData:!0}),this.Templates}.apply({}),g={PLAY:"PLAY",PAUSE:"PAUSE",FULLSCREEN:"FULLSCREEN",CC:"CC",GO_LIVE:"GO_LIVE",IS_LIVE:"IS_LIVE",MUTE:"MUTE",SHOW_SHARE:"show:share",SHARE:"share",VOLUME:"VOLUME",UNMUTE:"UNMUTE",REWIND:"REWIND",SEEK:"SEEK",SCRUB_START:"SCRUB_START",SCRUBBING:"SCRUBBING",LEARN_MORE:"LEARN_MORE"},h={ACTIVE:"ACTIVE",SHARE:"SHARE",SCRUBBING:"SCRUBBING",AD:"AD",HIDDEN:"HIDDEN"},i=d.View.extend({css:{},isShowing:function(){return!this.$el.hasClass(this.css.hide)},hide:function(){this.$el.addClass(this.css.hide)},show:function(){this.$el.removeClass(this.css.hide)}}),j={get:function(a){return{"-webkit-transform":a,"-ms-transform":a,transform:a}}},k={format:function(a){if(isNaN(a))return"00:00";var b=Math.floor(a/3600),c=Math.floor(a%3600/60),d=Math.floor(a%3600%60);return(0===b?"":10>b?"0"+b+":":b+":")+(10>c?"0"+c:c)+":"+(10>d?"0"+d:d)}},l=d.View.extend({events:{click:"toggle",touchstart:"toggle"},isOn:!1,initialize:function(a){if(a=a||{},this.css=a.css,!this.css)throw"no css specified for button";if(this.eventType=a.eventType,!this.eventType)throw"no event type specified for button";this.setStyle(!!a.on)},toggle:function(a){a.preventDefault(),a.stopPropagation();var b=this.eventType;(b.on||b.off)&&(b=this.isOn?b.on:b.off),this.trigger(b,{target:this,type:b,data:this.isOn}),this.setStyle(!this.isOn)},setStyle:function(a){this.isOn=a,a?(this.$el.addClass(this.css.on),this.$el.removeClass(this.css.off)):(this.$el.addClass(this.css.off),this.$el.removeClass(this.css.on))}}),m=i.extend({template:f["src/ad-view/template.html"],className:"pjs-ad-gui",css:{hide:"pjs-ad-gui-hidden"},events:function(){return this.options.buttonLink===m.LEARN_MORE_EVENT_ONLY?{"click .pjs-ad-gui-learn-more":"onLearnMore","touchstart .pjs-ad-gui-learn-more":"onLearnMore"}:void 0},initialize:function(a){this.render(a)},render:function(c){c=this.options=a.defaults(c||{},m.DEFAULT_COPY);var d=c.template||this.template;return this.$el.html(b(d(c))),this.delegateEvents(),this.$countdown=this.$(".pjs-ad-gui-countdown"),this.renderMessage(c),this},renderMessage:function(b){a.extend(this.options,b);var c=this.getTemplate(this.options),d=a.template(c)(this.options);this.$countdown.text(d)},getTemplate:function(a){var b=a.messageText;return a.time&&(b=a.countdownText),a.index>=0&&a.total>1?a.countdownTextWithPosition+" "+b:b},onLearnMore:function(a){this.options.buttonLink===m.LEARN_MORE_EVENT_ONLY&&(a.preventDefault(),a.stopPropagation(),this.trigger(g.LEARN_MORE,{type:g.LEARN_MORE}))}},{LEARN_MORE_EVENT_ONLY:"#",DEFAULT_COPY:{countdownText:"Your content will resume in <%=time%>.",countdownTextWithPosition:"Ad <%=index + 1%> of <%=total%>.",messageText:"Your content will resume shortly.",buttonText:"Learn More",buttonTarget:"_blank"}}),n=d.View.extend({template:f["src/top/template.html"],height:0,className:"pjs-gui-top",initialize:function(b){a.bindAll(this,"hide"),this.options=b=b||{},this.render(),this.cc=new l({el:this.$(".pjs-gui-controls-cc"),on:this.options.ccEnabled,css:{on:"pjs-gui-controls-cc-on",off:"pjs-gui-controls-cc"},eventType:g.CC}),this.fullScreen=new l({el:this.$(".pjs-gui-controls-fullscreen"),on:!this.options.isFullscreen,css:{on:"pjs-gui-controls-fullscreen",off:"pjs-gui-controls-fullscreen-minimize"},eventType:g.FULLSCREEN}),a.delay(this.hide,10)},show:function(){this.$el.css(j.get("translateY(0)"))},hide:function(){var a=this.getHeight();this.$el.css(j.get("translateY("+-a+"px)"))},getHeight:function(){return this.height<50&&(this.height=this.$el.height()),this.height>50?this.height:300},setMetadata:function(a){this.$(".pjs-gui-top-metadata").html(a)},render:function(){return this.$el.html(b(this.template(this.options))),this}}),o=i.extend({template:f["src/center-controls/template.html"],css:{hide:"pjs-gui-center-controls-hidden"},className:"pjs-gui-center-controls",initialize:function(a){this.options=a,this.render()},render:function(){var a=this.options;this.$el.html(b(this.template(a))),this.playPause=new l({el:this.$(".pjs-gui-controls-play-pause"),on:a.paused,eventType:{on:g.PLAY,off:g.PAUSE},css:{on:"pjs-gui-controls-play",off:"pjs-gui-controls-pause"}})},setPaused:function(a){this.playPause.setStyle(a)}}),p={availableShareItems:["facebook","twitter","embed","link"],validate:function(b){return b.share&&(b.share=a.intersection(b.share,p.availableShareItems)),b}},q=function(){var a={hide:"pjs-share-hidden"};return d.View.extend({tagName:"div",template:f["src/share/template.html"],className:"pjs-gui-center-controls pjs-share",initialize:function(a){this.options=a,this.render()},render:function(){var a=p.validate(this.options||{});this.$el.html(b(this.template(a)))},hide:function(){this.$el.addClass(a.hide)},show:function(){this.$el.removeClass(a.hide)}})}(),r=function(){var c=function(){var c="slider:resize",f="pjs-gui-controls-slider-thumb",h="pjs-gui-controls-slider-thumb-active",i=function(a){var b=a.pageX;return b>0?b:a.touches&&a.touches.length>0?a.touches[0].pageX:0},j={_isLive:!1,IS_LIVE_THRESHOLD:3,checkLive:function(){var a=this.isLive();this._isLive!==a&&(this.trigger(g.IS_LIVE,{type:g.IS_LIVE,data:a,target:this}),this._isLive=a)},isLive:function(){return this.duration-this.playhead<this.IS_LIVE_THRESHOLD}},k={isSegmented:!0,createDividers:function(){this.$dividerContainer.empty(),a.each(this.durations,function(){this.$dividerContainer.append(b('<div class="pjs-gui-controls-slider-segment"/>'))},this)},moveDividers:function(){var c=this.$dividerContainer.children();a.each(this.durations,function(a,d){b(c[d]).css({left:this.getLeftFromPlayhead(a)})},this)}};return d.View.extend({logger:new e("GUI.Slider"),enabled:!0,dragging:!1,duration:0,playhead:0,sliderWidth:0,events:function(){return a.extend({click:"onSliderClick",touchstart:"onSliderClick","touchstart .pjs-gui-controls-slider-thumb-container":"onThumbActive","touchmove .pjs-gui-controls-slider-thumb-container":"onThumbMove","touchend .pjs-gui-controls-slider-thumb-container":"onThumbInactive","mousedown .pjs-gui-controls-slider-thumb-container":"onThumbActive"})},initialize:function(c){this.options=c,a.bindAll(this,"onThumbMove","onThumbInactive");var d=b(document);this.listenTo(d,"mousemove",this.onThumbMove),this.listenTo(d,"mouseup",this.onThumbInactive),this.$thumbContainer=this.$(".pjs-gui-controls-slider-thumb-container"),this.$progress=this.$(".pjs-gui-controls-slider-progress"),this.$buffered=this.$(".pjs-gui-controls-slider-buffered"),this.$dividerContainer=this.$(".pjs-gui-controls-slider-segment-container"),this.throttledMeasure=a.throttle(this.measure,1500),this.throttledRender=a.throttle(this.render,250),this.setDurations(this.options.durations),this.setPlayhead(this.options.playhead),c.isDVR?a.extend(this,j):c.isLive&&this.setEnabled(!1)},setPlayhead:function(a){this.dragging||(isNaN(a)&&(a=parseFloat(a,10)),isNaN(a)||(a=Math.round(100*a)/100,this.playhead=Math.max(0,Math.min(a,this.duration)),this.throttledRender()))},setDurations:function(b){if(a.isArray(b)){!this.options.isLive&&b.length>1&&!this.isSegmented&&a.extend(this,k);var d=0;this.durations=a.map(b,function(a){return d+=a}),this.duration=this.durations.pop(),this.throttledMeasure(),this.isSegmented?(this.createDividers(),this.moveDividers(),this.$dividerContainer.show(),this.on(c,a.bind(this.moveDividers,this))):this.$dividerContainer.hide(),this.throttledRender()}},render:function(){this.dragging||(this.throttledMeasure(),this.moveThumb(this.getLeftFromPlayhead(this.isLive()?this.duration:this.playhead)))},setBuffered:function(a){if(!this.dragging&&this.duration>1){var b=Math.max(0,this.getLeftFromPlayhead(a));this.throttledMeasure(),b=Math.min(b,this.sliderWidth),this.$buffered.css({width:b})}},measure:function(){var a=this.$el[0].offsetWidth;a!==this.sliderWidth&&(this.sliderWidth=a,this.trigger(c,a))},isLive:function(){return!1},setEnabled:function(a){a!==this.enabled&&(a?(this.$thumbContainer.show(),this.$buffered.show(),this.$progress.show()):(this.$thumbContainer.hide(),this.$progress.hide(),this.$buffered.hide())),this.enabled=a},onSliderClick:function(a){if(a.preventDefault(),a.stopPropagation(),this.logger.info("onSliderClick"),this.enabled&&!b(a.target).hasClass(f)){var c=i(a);this.containerOffset||(this.containerOffset=this.$el.offset().left),this.moveThumb(c-this.containerOffset),this.sendSeek()}},onThumbActive:function(a){a.preventDefault();var b=this.$("."+f);b.addClass(h),this.dragging=!0,this.throttledMeasure(),this.$buffered.css({width:0}),this.trigger(g.SCRUB_START,{type:g.SCRUB_START,data:this.playhead})},onThumbMove:function(a){if(this.dragging){a.preventDefault();var b=i(a);this.containerOffset||(this.containerOffset=this.$el.offset().left),this.moveThumb(b-this.containerOffset)}},onThumbInactive:function(a){if(this.dragging){a.preventDefault();var b=this.$("."+h);b.removeClass(h),this.dragging=!1,this.sendSeek()}},moveThumb:function(a){var b=Math.max(0,a);b=Math.min(b,this.sliderWidth),isNaN(b)||Math.abs(this.lastLeft-b)<.25||(this.$thumbContainer.css({left:b}),this.$progress.css({width:b}),this.trigger(g.SCRUBBING,{type:g.SCRUBBING,data:this.getTimeFromThumb(b)}),this.lastLeft=b)},getLeftFromPlayhead:function(a){if(!a)return 0;var b=a/Math.max(1,this.duration);return b*this.sliderWidth},getTimeFromThumb:function(a){isNaN(a)&&(a=parseFloat(this.$thumbContainer.css("left"),10));var b=a/this.sliderWidth;return b*this.duration},sendSeek:function(){this.setPlayhead(this.getTimeFromThumb()),this.trigger(g.SEEK,{type:g.SEEK,data:this.playhead})}})}();return i.extend({template:f["src/bottom/template.html"],className:"pjs-controls",css:{hide:"pjs-gui-controls-hidden",slider:"pjs-gui-controls-slider",currentTime:"pjs-gui-current-time",duration:"pjs-gui-duration"},initialize:function(b){this.options=b,a.bindAll(this,"sendEvent","onScrubbing"),a.extend(this.options,{slider:this.css.slider}),this.render()},render:function(){var a=this.options;this.$el.html(b(this.template(a))),this.$currentTime=this.$("."+this.css.currentTime).html(k.format(a.playhead)),this.$duration=this.$("."+this.css.duration),this.slider=new c({el:this.$("."+this.css.slider),playhead:a.playhead,isLive:a.isLive,isDVR:a.isDVR,durations:a.durations}),this.setDurations(a.durations),this.listenTo(this.slider,g.SEEK,this.sendEvent),this.listenTo(this.slider,g.SCRUB_START,this.sendEvent),this.listenTo(this.slider,g.SCRUBBING,this.sendEvent),this.listenTo(this.slider,g.SCRUBBING,this.onScrubbing)},getPlayhead:function(){return this.slider.playhead},onScrubbing:function(a){this.$currentTime.text(k.format(a.data))},setPlayhead:function(a){this.slider.setPlayhead(a)},setBuffered:function(a){this.slider.setBuffered(a)},setDurations:function(b){this.totalDuration=a.reduce(b,function(a,b){return a+b},0),this.$duration.html(k.format(this.totalDuration)),this.slider.setDurations(b)},sendEvent:function(a){a.target=this,this.trigger(a.type,a)}})}(),s=d.View.extend({className:"pjs-gui",logger:new e("PJS-GUI"),events:{"click .pjs-gui-share-item":"onShare","touchstart .pjs-gui-share-item":"onShare","click .pjs-gui-controls-share":"shareButtonClick","touchstart .pjs-gui-controls-share":"shareButtonClick","click .pjs-gui-controls-rewind":"onRewind","touchstart .pjs-gui-controls-rewind":"onRewind"},initialize:function(b){this.options=b,a.bindAll(this,"sendEvent","hide"),this.render()},render:function(){var a=this.options||{};return this.$background=b("<div/>").addClass("pjs-gui-background").appendTo(this.$el),this.centerView=new o(a),this.centerView.$el.appendTo(this.$el),this.listenTo(this.centerView.playPause,g.PLAY,this.hide),this.listenTo(this.centerView.playPause,g.PLAY,this.sendEvent),this.listenTo(this.centerView.playPause,g.PAUSE,this.sendEvent),this.shareView=new q(a),this.shareView.$el.appendTo(this.$el),this.shareView.hide(),this.topView=new n(a),this.topView.$el.appendTo(this.$el),this.listenTo(this.topView.cc,g.CC,this.sendEvent),this.listenTo(this.topView.fullScreen,g.FULLSCREEN,this.sendEvent),this.adView=new m(a.adView),this.adView.$el.appendTo(this.$el),this.listenTo(this.adView,g.LEARN_MORE,this.sendEvent),this.adView.hide(),this.bottomView=new r(a),this.bottomView.$el.appendTo(this.$el),this.listenTo(this.bottomView,g.SEEK,this.hide),this.listenTo(this.bottomView,g.SCRUB_START,this.onScrubbing),this.listenTo(this.bottomView,g.SEEK,this.sendEvent),this.allViews=[this.centerView,this.$background,this.bottomView,this.topView,this.shareView],this.hide(),this},show:function(){this.setState(h.ACTIVE)},hide:function(){this.setState(h.HIDDEN)},sendEvent:function(b){a.isString(b)&&(b={type:b}),b.target=this,this.trigger(b.type,b)},setPaused:function(a){this.centerView.setPaused(a)},isDragging:function(){return this.bottomView.slider.dragging},setState:function(b,c){switch(this.state=b,this.logger.info("state:",b),b){case h.ACTIVE:this.bottomView.slider.setEnabled(!0),a.invoke([this.shareView,this.adView],"hide"),a.invoke(a.without(this.allViews,this.shareView),"show");break;case h.SHARE:this.logger.info("show share panel"),this.centerView.hide(),this.shareView.show(),this.sendEvent(g.SHOW_SHARE);break;case h.SCRUBBING:a.invoke(a.without(this.allViews,this.bottomView),"hide");break;case h.HIDDEN:a.invoke(this.allViews,"hide");break;case h.AD:this.logger.info("ad state options:",c),a.invoke(this.allViews,"hide"),this.bottomView.slider.setEnabled(!1),this.adView.render(a.extend(this.adView.options,c)),this.adView.show();break;default:this.logger.error("Unrecognized state",b)}},shareButtonClick:function(a){a.preventDefault(),a.stopPropagation(),this.setState(this.centerView.isShowing()?h.SHARE:h.ACTIVE)},setPlayhead:function(a){this.bottomView.setPlayhead(a)},setEnabled:function(a){this.bottomView.slider.setEnabled(a)},setBuffered:function(a){this.bottomView.setBuffered(a)},setDurations:function(a){this.bottomView.setDurations(a)},onScrubbing:function(){this.setState(h.SCRUBBING)},onFullscreen:function(a){a.preventDefault(),a.stopPropagation(),this.sendEvent(g.FULLSCREEN)},showFullscreenButton:function(a){this.topView.fullScreen.setStyle(a)},onRewind:function(a){a.preventDefault(),a.stopPropagation(),this.sendEvent({type:g.REWIND,data:10})},onShare:function(a){this.logger.info("onShare"),a.preventDefault(),a.stopPropagation(),this.sendEvent({type:g.SHARE,data:b(a.target).data("share-id")})}}),t=s;return t.version="0.14.0",t.build="Mon Feb 09 2015 08:49:38",t.Time=k,t.AdView=m,t.BottomView=r,t.TopView=n,t.ToggleableButton=l,t.Events=g,t.States=h,t});
//# sourceMappingURL=pjs.min.js.map