!function(a,b){"object"==typeof exports?module.exports=b(require("underscore"),require("jquery"),require("handlebars"),require("backbone")):"function"==typeof define&&define.amd&&define(["underscore","jquery","handlebars","backbone"],b)}(this,function(a,b,c,d){function e(b){this.options=a.defaults(b||{},i),this.render(this.options)}var f={version:"0.8.5",build:"Tue May 13 2014 14:04:25"},g=function(){return this.Templates=this.Templates||{},this.Templates["src/ad-display/template.html"]=c.template(function(a,b,c,d,e){function f(a,b){var d,e="";return e+='\n	    <a class="mtvn-ad-gui-learn-more" href="',(d=c.buttonLink)?d=d.call(a,{hash:{},data:b}):(d=a.buttonLink,d=typeof d===i?d.apply(a):d),e+=j(d)+'" target="',(d=c.buttonTarget)?d=d.call(a,{hash:{},data:b}):(d=a.buttonTarget,d=typeof d===i?d.apply(a):d),e+=j(d)+'">\n	    	',(d=c.buttonText)?d=d.call(a,{hash:{},data:b}):(d=a.buttonText,d=typeof d===i?d.apply(a):d),e+=j(d)+"\n	    </a>\n	    "}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var g,h="",i="function",j=this.escapeExpression,k=this;return h+='<div class="mtvn-ad-gui">\n	<div class="mtvn-ad-gui-container">\n	    <span class="mtvn-ad-gui-countdown"></span>\n	    ',g=c["if"].call(b,b.buttonLink,{hash:{},inverse:k.noop,fn:k.program(1,f,e),data:e}),(g||0===g)&&(h+=g),h+="\n	</div>\n</div>"}),this.Templates["src/controls/template.html"]=c.template(function(a,b,c,d,e){function f(){return'\n<div class="mtvn-controls-rewind mtvn-controls-button"></div>\n'}function g(){return'\n<div class="mtvn-controls-live mtvn-controls-button"></div>\n'}function h(){return'\n<div class="mtvn-controls-cc mtvn-controls-button"></div>\n'}function i(){return'\n<div class="mtvn-controls-volume mtvn-controls-button">\n	<div class="mtvn-controls-volume-slider-container-outer">\n		<div class="mtvn-controls-volume-slider-container">\n			<div class="mtvn-controls-volume-slider">\n				<div class="mtvn-controls-volume-slider-foreground"></div>\n			</div>\n		</div>\n	</div>\n</div>\n'}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var j,k="",l=this,m="function",n=this.escapeExpression;return k+="<!-- controls -->\n",j=c["if"].call(b,b.isDVR,{hash:{},inverse:l.noop,fn:l.program(1,f,e),data:e}),(j||0===j)&&(k+=j),k+='\n<div class="mtvn-controls-play-pause mtvn-controls-button"></div>\n',j=c["if"].call(b,b.isLive,{hash:{},inverse:l.noop,fn:l.program(3,g,e),data:e}),(j||0===j)&&(k+=j),k+='\n<div class="',(j=c.slider)?j=j.call(b,{hash:{},data:e}):(j=b.slider,j=typeof j===m?j.apply(b):j),k+=n(j)+'">\n	<div class="',(j=c.slider)?j=j.call(b,{hash:{},data:e}):(j=b.slider,j=typeof j===m?j.apply(b):j),k+=n(j)+'-time-display"></div>\n	<div class="',(j=c.slider)?j=j.call(b,{hash:{},data:e}):(j=b.slider,j=typeof j===m?j.apply(b):j),k+=n(j)+'-progress-container">\n		<div class="',(j=c.slider)?j=j.call(b,{hash:{},data:e}):(j=b.slider,j=typeof j===m?j.apply(b):j),k+=n(j)+'-buffered"></div>\n		<div class="',(j=c.slider)?j=j.call(b,{hash:{},data:e}):(j=b.slider,j=typeof j===m?j.apply(b):j),k+=n(j)+'-progress"></div>\n	</div>\n	<div class="',(j=c.slider)?j=j.call(b,{hash:{},data:e}):(j=b.slider,j=typeof j===m?j.apply(b):j),k+=n(j)+'-background"></div>\n	<div class="',(j=c.slider)?j=j.call(b,{hash:{},data:e}):(j=b.slider,j=typeof j===m?j.apply(b):j),k+=n(j)+'-segment-container"></div>\n	<div class="',(j=c.slider)?j=j.call(b,{hash:{},data:e}):(j=b.slider,j=typeof j===m?j.apply(b):j),k+=n(j)+'-thumb-container">\n		<div class="',(j=c.slider)?j=j.call(b,{hash:{},data:e}):(j=b.slider,j=typeof j===m?j.apply(b):j),k+=n(j)+'-tool-tip-container">\n			<div class="',(j=c.slider)?j=j.call(b,{hash:{},data:e}):(j=b.slider,j=typeof j===m?j.apply(b):j),k+=n(j)+'-tool-tip-background"></div>\n			<div class="',(j=c.slider)?j=j.call(b,{hash:{},data:e}):(j=b.slider,j=typeof j===m?j.apply(b):j),k+=n(j)+'-tool-tip-time"></div>\n		</div>\n		<div class="',(j=c.slider)?j=j.call(b,{hash:{},data:e}):(j=b.slider,j=typeof j===m?j.apply(b):j),k+=n(j)+'-thumb"/>\n	</div>\n</div>\n',j=c["if"].call(b,b.ccEnabled,{hash:{},inverse:l.noop,fn:l.program(5,h,e),data:e}),(j||0===j)&&(k+=j),k+="\n",j=c["if"].call(b,b.showVolume,{hash:{},inverse:l.noop,fn:l.program(7,i,e),data:e}),(j||0===j)&&(k+=j),k+='\n<div class="mtvn-controls-fullscreen mtvn-controls-button"></div>'}),this.Templates["src/top-panel/top-panel.html"]=c.template(function(a,b,c,d,e){function f(a){var b="";return b+='\n	<div class="mtvn-tp-share-divider"></div>\n	<div class="mtvn-tp-share-item mtvn-tp-'+k(typeof a===j?a.apply(a):a)+'" data-share-id="'+k(typeof a===j?a.apply(a):a)+'"></div>\n	'}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var g,h,i="",j="function",k=this.escapeExpression,l=this,m=c.blockHelperMissing;return i+='<div class="mtvn-tp-container">\n	<span class="mtvn-tp-metadata">',(g=c.metadata)?g=g.call(b,{hash:{},data:e}):(g=b.metadata,g=typeof g===j?g.apply(b):g),(g||0===g)&&(i+=g),i+='</span>\n	<div class="mtvn-tp-share">\n	',h={hash:{},inverse:l.noop,fn:l.program(1,f,e),data:e},(g=c.share)?g=g.call(b,h):(g=b.share,g=typeof g===j?g.apply(b):g),c.share||(g=m.call(b,g,h)),(g||0===g)&&(i+=g),i+="\n	</div>\n</div>"}),this.Templates}.apply({}),h=g["src/ad-display/template.html"],i={countdownText:"Your content will resume in {{time}}.",messageText:"Your content will resume shortly.",buttonText:"Learn More",buttonTarget:"_blank"};e.prototype={render:function(a){var c=a.template||h,d=this.$el=b(c(a));return this.$countdown=d.find(".mtvn-ad-gui-countdown"),this.renderMessage(a.time),d},renderMessage:function(b){var c=this.options[a.isUndefined(b)?"messageText":"countdownText"],d=a.template(c,{time:b},{interpolate:/\{\{(.+?)\}\}/g});this.$countdown.text(d)}};var j={availableShareItems:["facebook","twitter","email"],validate:function(b){return b.share&&(b.share=a.intersection(b.share,j.availableShareItems)),b}},k=d.View.extend({template:g["src/top-panel/top-panel.html"],tagName:"div",className:"mtvn-tp",events:{"click .mtvn-tp-share":"onShare","touchstart .mtvn-tp-share":"onShare"},initialize:function(a){this.options=j.validate(a||{}),this.render()},setMetadata:function(a){this.$(".mtvn-tp-metadata").html(a)},render:function(){this.$el.html(b(this.template(this.options)))},onShare:function(a){a.preventDefault(),this.trigger(k.Events.SHARE,b(a.target).data("share-id"))}},{Events:{SHARE:"share"}}),l=function(){return d.View.extend({ccEnabled:!1,className:"mtvn-controls-cc",events:{click:"toggle",touchstart:"toggle"},toggle:function(a){a.preventDefault(),this.trigger(n.CC,{type:n.CC})}})}(),m=function(){var c=function(){var c="slider:resize",e="mtvn-controls-slider-thumb",f="mtvn-controls-slider-thumb-active",g=function(a){if(isNaN(a))return"00:00";var b=Math.floor(a/3600),c=Math.floor(a%3600/60),d=Math.floor(a%3600%60);return(0===b?"":10>b?"0"+b+":":b+":")+(10>c?"0"+c:c)+":"+(10>d?"0"+d:d)},h={_isLive:!1,IS_LIVE_THRESHOLD:3,checkLive:function(){var a=this.isLive();this._isLive!==a&&(this.trigger(n.IS_LIVE,{type:n.IS_LIVE,data:a,target:this}),this._isLive=a)},isLive:function(){return this.duration-this.playhead<this.IS_LIVE_THRESHOLD}},i={isSegmented:!0,createDividers:function(){this.$dividerContainer.empty(),a.each(this.durations,function(){this.$dividerContainer.append(b('<div class="mtvn-controls-slider-segment"/>'))},this)},moveDividers:function(){var c=this.$dividerContainer.children();a.each(this.durations,function(a,d){b(c[d]).css({left:this.getLeftFromPlayhead(a)})},this)}};return d.View.extend({enabled:!0,dragging:!1,duration:0,playhead:0,sliderWidth:0,events:function(){return a.extend({click:"onSliderClick",touchstart:"onSliderClick","touchstart .mtvn-controls-slider-thumb-container":"onThumbActive","touchmove .mtvn-controls-slider-thumb-container":"onThumbMove","touchend .mtvn-controls-slider-thumb-container":"onThumbInactive","mousedown .mtvn-controls-slider-thumb-container":"onThumbActive"})},initialize:function(c){this.options=c,a.bindAll(this,"onThumbMove","onThumbInactive");var d=b(document);this.listenTo(d,"mousemove",this.onThumbMove),this.listenTo(d,"mouseup",this.onThumbInactive),this.$thumbContainer=this.$(".mtvn-controls-slider-thumb-container"),this.$progress=this.$(".mtvn-controls-slider-progress"),this.$buffered=this.$(".mtvn-controls-slider-buffered"),this.$timeDisplay=this.$(".mtvn-controls-slider-time-display"),this.$toolTipContainer=this.$(".mtvn-controls-slider-tool-tip-container"),this.$toolTipContainer.hide(),this.$toolTipTime=this.$(".mtvn-controls-slider-tool-tip-time"),this.$dividerContainer=this.$(".mtvn-controls-slider-segment-container"),this.throttledMeasure=a.throttle(this.measure,1500),this.throttledRender=a.throttle(this.render,250),this.setDurations(this.options.durations),this.setPlayhead(this.options.playhead),c.isDVR?a.extend(this,h):c.isLive&&this.setEnabled(!1)},setPlayhead:function(a){this.dragging||this.seeking||(isNaN(a)&&(a=parseFloat(a,10)),isNaN(a)||(a=Math.round(100*a)/100,this.playhead=Math.max(0,Math.min(a,this.duration)),this.throttledRender()))},setDurations:function(b){if(a.isArray(b)){!this.options.isLive&&b.length>1&&!this.isSegmented&&a.extend(this,i);var d=0;this.durations=a.map(b,function(a){return d+=a}),this.duration=this.durations.pop(),this.throttledMeasure(),this.isSegmented?(this.createDividers(),this.moveDividers(),this.$dividerContainer.show(),this.on(c,a.bind(this.moveDividers,this))):this.$dividerContainer.hide(),this.throttledRender()}},render:function(){this.dragging||this.seeking||(this.checkLive(),this.throttledMeasure(),this.moveThumb(this.getLeftFromPlayhead(this.isLive()?this.duration:this.playhead)),this.updateTime())},setBuffered:function(a){if(!this.dragging&&!this.seeking&&this.duration>1){var b=Math.max(0,this.getLeftFromPlayhead(a));this.throttledMeasure(),b=Math.min(b,this.sliderWidth),this.$buffered.css({width:b})}},measure:function(){var a=this.$el[0].offsetWidth;a!==this.sliderWidth&&(this.sliderWidth=a,this.trigger(c,a))},isLive:function(){return!1},checkLive:function(){},setEnabled:function(a){a!==this.enabled&&(a?(this.$thumbContainer.show(),this.$timeDisplay.css({visibility:"visible"}),this.$buffered.show(),this.$progress.show()):(this.$thumbContainer.hide(),this.$timeDisplay.css({visibility:"hidden"}),this.$progress.hide(),this.$buffered.hide())),this.enabled=a},onSliderClick:function(a){if(a.preventDefault(),this.enabled&&!b(a.target).hasClass(e)){var c=a.pageX;this.containerOffset||(this.containerOffset=this.$el.offset().left),this.moveThumb(c-this.containerOffset),this.sendSeek()}},onThumbActive:function(a){a.preventDefault();var b=this.$("."+e);b.removeClass(e),b.addClass(f),this.dragging=!0,this.throttledMeasure(),this.$buffered.css({width:0}),this.$toolTipTime.html(g(this.playhead)),this.$toolTipContainer.show()},onThumbMove:function(a){if(this.dragging){a.preventDefault();var b=a.pageX;this.containerOffset||(this.containerOffset=this.$el.offset().left),this.moveThumb(b-this.containerOffset)}},onThumbInactive:function(a){if(this.dragging){a.preventDefault();var b=this.$("."+f);b.removeClass(f),b.addClass(e),this.dragging=!1,this.sendSeek(),this.$toolTipContainer.hide()}},moveThumb:function(a){var b=Math.max(0,a);b=Math.min(b,this.sliderWidth),isNaN(b)||Math.abs(this.lastLeft-b)<.25||(this.$thumbContainer.css({left:b}),this.$progress.css({width:b}),this.$toolTipTime.html(g(this.getTimeFromThumb(b))),this.lastLeft=b)},getLeftFromPlayhead:function(a){if(!a)return 0;var b=a/Math.max(1,this.duration);return b*this.sliderWidth},getTimeFromThumb:function(a){isNaN(a)&&(a=parseFloat(this.$thumbContainer.css("left"),10));var b=a/this.sliderWidth;return b*this.duration},updateTime:function(){this.$timeDisplay.html(this.getTimeDisplayText())},getTimeDisplayText:function(){return this.duration?this.isLive()?g(this.duration):'<span class="mtvn-controls-slider-current-time">'+g(this.playhead)+"</span> / "+g(this.duration):""},sendSeek:function(){this.setPlayhead(this.getTimeFromThumb()),this.trigger(n.SEEK,{type:n.SEEK,data:this.playhead})}})}(),e=g["src/controls/template.html"],f={hide:"mtvn-controls-hidden",slider:"mtvn-controls-slider",playPause:"mtvn-controls-play-pause",live:"mtvn-controls-live",volume:"mtvn-controls-volume",cc:"mtvn-controls-cc"},h=function(b,c,d,e){a.each(d,function(a){b.listenTo(c,a,e)})};return d.View.extend({tagName:"div",className:"mtvn-controls",events:{"click .mtvn-controls-fullscreen":"onFullscreen","touchstart .mtvn-controls-fullscreen":"onFullscreen","click .mtvn-controls-rewind":"onRewind","touchstart .mtvn-controls-rewind":"onRewind"},initialize:function(b){this.options=b,a.bindAll(this,"sendEvent"),a.extend(this.options,{slider:f.slider}),this.render()},render:function(){var a=this.options;this.$el.html(b(e(a))),this.playPauseButton=new p({el:this.$("."+f.playPause),paused:a.paused}),h(this,this.playPauseButton,[n.PLAY,n.PAUSE],this.sendEvent),this.slider=new c({el:this.$("."+f.slider),playhead:a.playhead,isLive:a.isLive,isDVR:a.isDVR,durations:a.durations}),this.listenTo(this.slider,n.SEEK,this.sendEvent),a.isLive&&(this.liveButton=new o({el:this.$("."+f.live),isLive:a.isLive}),a.isDVR&&(this.listenTo(this.liveButton,n.GO_LIVE,this.sendEvent),this.liveButton.listenTo(this.slider,n.IS_LIVE,this.liveButton.onLiveChange))),a.showVolume&&(this.volumeButton=new q({volume:a.volume,muted:a.muted,showVolumeSlider:a.showVolumeSlider,el:this.$("."+f.volume)}),h(this,this.volumeButton,[n.VOLUME,n.MUTE,n.UNMUTE],this.sendEvent)),this.closedCaptionButton=new l({ccEnabled:a.ccEnabled,el:this.$("."+f.cc)}),this.listenTo(this.closedCaptionButton,n.CC,this.sendEvent)},hide:function(){this.$el.addClass(f.hide),this.volumeButton&&this.volumeButton.setEnabled(!1)},show:function(){this.$el.removeClass(f.hide),this.volumeButton&&this.volumeButton.setEnabled(!0)},setVolume:function(a){this.volumeButton&&this.volumeButton.setVolume(a)},setPaused:function(a){this.playPauseButton.setPaused(a)},getPlayhead:function(){return this.slider.playhead},setPlayhead:function(a){this.slider.setPlayhead(a)},setBuffered:function(a){this.slider.setBuffered(a)},setDurations:function(a){this.slider.setDurations(a)},sendEvent:function(a){a.target=this,this.trigger(a.type,a)},onRewind:function(){event.preventDefault(),this.sendEvent({type:n.REWIND})},onFullscreen:function(a){a.preventDefault(),this.sendEvent({type:n.FULLSCREEN})}})}(),n={PLAY:"PLAY",PAUSE:"PAUSE",FULLSCREEN:"FULLSCREEN",CC:"CC",GO_LIVE:"GO_LIVE",IS_LIVE:"IS_LIVE",MUTE:"MUTE",VOLUME:"VOLUME",UNMUTE:"UNMUTE",REWIND:"REWIND",SEEK:"SEEK"},o=function(){var b={live:"mtvn-controls-is-live",golive:"mtvn-controls-go-live"};return d.View.extend({initialize:function(b){this.options=b,this.setLive(b.isLive),a.bindAll(this,"onLiveChange")},events:{click:"toggle",touchstart:"toggle"},onLiveChange:function(a){this.setLive(a.data)},setLive:function(a){var c=this.$el;c.toggleClass(b.live,a),c.toggleClass(b.golive,!a)},toggle:function(a){a.preventDefault(),this.$el.hasClass(b.golive)&&this.trigger(n.GO_LIVE,{type:n.GO_LIVE})}})}(),p=function(){var a={play:"mtvn-controls-play",pause:"mtvn-controls-pause"};return d.View.extend({initialize:function(b){this.options=b,this.$el.addClass(this.options.paused?a.play:a.pause)},events:{click:"toggle",touchstart:"toggle"},setPaused:function(b){var c=this.$el;c.toggleClass(a.play,b),c.toggleClass(a.pause,!b)},toggle:function(b){b.preventDefault();var c=this.$el,d=c.hasClass(a.pause),e=d?n.PAUSE:n.PLAY;c.toggleClass(a.play,d),c.toggleClass(a.pause,!d),this.trigger(e,{type:e})}})}(),q=function(){var c={controls:"mtvn-controls",unmute:"mtvn-controls-unmute",mute:"mtvn-controls-mute",showSlider:"mtvn-controls-volume-slider-container-over",slider:"mtvn-controls-volume-slider",thumb:"mtvn-controls-volume-slider-foreground"},e=function(a){var d=b(a.target);return d.hasClass(c.mute)||d.hasClass(c.unmute)};return d.View.extend({enabled:!0,defaultEvents:{click:"toggle",touchstart:"toggle"},mouseEvents:{"click .mtvn-controls-volume-slider":"onSliderClick","touchstart .mtvn-controls-volume-slider":"onSliderClick",mouseover:"onMouseOver",mouseleave:"onMouseOut","mousedown .mtvn-controls-volume-slider-foreground":"onThumbActive","touchstart .mtvn-controls-volume-slider-foreground":"onThumbActive"},events:function(){return this.options.showVolumeSlider?a.extend(this.defaultEvents,this.mouseEvents):this.defaultEvents},initialize:function(d){if(a.bindAll(this,"updateView"),this.options=d,d.showVolumeSlider){a.bindAll(this,"onThumbMove","onThumbInactive","toggleSlider");var e=b(document);this.listenTo(e,"mousemove",this.onThumbMove),this.listenTo(e,"mouseup",this.onThumbInactive),this.$slider=this.$("."+c.slider),this.$container=b(this.$slider.parent()),this.$thumb=this.$("."+c.thumb)}this.isMuted=this.options.muted,this.setVolume(isNaN(d.volume)?.7:d.volume),a.delay(this.updateView,100)},setEnabled:function(a){this.enabled!==a&&(this.enabled=a,!a&&this.$container&&this.$container.removeClass(c.showSlider))},onThumbActive:function(a){a.preventDefault(),this.dragging=!0},getElementOffset:function(){if(!this.elOffset){var a=this.$el.offset();a.width>0&&(this.elOffset=a)}return this.elOffset},onMouseOut:function(d){this.isMouseOver=!1;var e=d.offsetX,f=this.getElementOffset();a.isUndefined(e)&&(e=d.pageX-f.left);var g=0>e||e>=f.width,h=b(d.toElement?d.toElement:d.relatedTarget),i=g&&h.hasClass(c.controls)?0:1500;a.delay(this.toggleSlider,i)},onMouseOver:function(){this.isMouseOver=this.enabled,this.toggleSlider()},toggleSlider:function(){this.$container.toggleClass(c.showSlider,this.isMouseOver)},onSliderClick:function(a){a.preventDefault(),this.isMuted=!1,this.trigger(n.UNMUTE,{type:n.UNMUTE}),this.setVolume(this.calculatePercentageFromTop(a.pageY-this.getContainerOffset()))},updateView:function(b){a.isUndefined(b)&&(b=this.isMuted?0:this.currentVolume),this.$thumb&&(this.$thumb.css({top:this.calculateSliderValueFromPercentage(b)}),0===this.getVolumeHeight()&&a.delay(this.updateView,100));var d=b>0;this.$el.toggleClass(c.mute,d),this.$el.toggleClass(c.unmute,!d)},onThumbMove:function(a){if(this.dragging){a.preventDefault();var b=a.pageY;this.isMuted=!1,this.trigger(n.UNMUTE,{type:n.UNMUTE}),this.setVolume(this.calculatePercentageFromTop(b-this.getContainerOffset()))}},onThumbInactive:function(a){this.dragging&&(a.preventDefault(),this.dragging=!1)},calculatePercentageFromTop:function(a){var b=Math.max(0,a),c=this.getVolumeHeight();return b=Math.min(b,c),1-b/c},calculateSliderValueFromPercentage:function(a){return(1-a)*this.getVolumeHeight()},getContainerOffset:function(){return this.containerOffset||(this.containerOffset=this.$slider.offset().top),this.containerOffset},getVolumeHeight:function(){return this.volumeHeight||(this.volumeHeight=this.$slider.offset().height-this.$thumb.offset().height),this.volumeHeight},setVolume:function(a){isNaN(a)||(a=Math.round(100*a)/100,this.currentVolume!==a&&(this.currentVolume=a,this.trigger(n.VOLUME,{type:n.VOLUME,data:this.currentVolume,target:this}),this.updateView()))},toggle:function(a){if(this.isMuted=!1,a.preventDefault(),e(a)){var b=this.$el,d=b.hasClass(c.unmute),f=d?n.UNMUTE:n.MUTE,g=d?this.currentVolume:0;this.updateView(g),this.trigger(f,{type:f})}}})}();return f.AdDisplay=e,f.Controls=m,f.TopPanel=k,f.Events=n,f});